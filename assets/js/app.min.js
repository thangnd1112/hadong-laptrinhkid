function initToken(){client=google.accounts.oauth2.initTokenClient({client_id:"813376710260-taq6rj3ign28567ptun19idc0b0ck147.apps.googleusercontent.com",scope:SCOPE,callback:e=>{access_token=e.access_token}})}function getToken(){client.requestAccessToken(),$("#loginGg").text("Sau khi Login thành công, click nút Run")}function revokeToken(){google.accounts.oauth2.revoke(access_token,()=>{console.log("access token revoked")})}function resets(){window.location.reload()}function getApi(e){var t=/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/,o=e.match(t),n="https://sheets.googleapis.com/v4/spreadsheets/"+o[1]+"/values/Trang%20tính1?alt=json&access_token="+access_token;return n}function initClient(){function e(){let e,t=[],o=[];setStatusLoading(),$.getJSON(link_total_url_api,function(n){e=n.values;for(let o=1;o<e.length;o++)t.push(e[o]);for(let e=0;e<t.length;e++)o.push(t[e][0])}).done(function(e,n,a){removeTableRows(),clearTimeouts(),callAPIOnInterval(5,o,t)})}var t="https://docs.google.com/spreadsheets/d/1EuL-eMxd05B1byZtkZcHmXP1sqjq_gqSF7gElStyj9g/edit#gid=0";link_total_url_api=getApi(t),$.getJSON(link_total_url_api,function(e){let t=[],o=[];for(var n=e.values,a=1;a<n.length;a++)t.push(n[a][1]);o=t.filter(function(e,o){return t.indexOf(e)===o}),o.sort()}).done(()=>window.filterOnNewTab?filter():e())}function filter(){window.filterOnNewTab=!1;let e=[],t=[],o=[],n=[];setStatusLoading(),$.getJSON(link_total_url_api,function(a){for(var l=a.values,r=1;r<l.length;r++)t.push(l[r][1]);n=t.filter(function(e,o){return t.indexOf(e)===o}),l.map(t=>{"Đang Học"===t[3]&&t[1]==filterBy[1]&&e.push(t)});for(r=0;r<e.length;r++)o.push(e[r][0])}).done(function(){removeTableRows(),clearTimeouts(),callAPIOnInterval(5,o,e)})}function callAPIOnInterval(e,t,o,n=0){let a=[];for(let l=n;l<=e&&l<t.length;l++){l==e&&timeouts.push(setTimeout(()=>callAPIOnInterval(e+3,t,o,l+1),7e3)),0===n&&(allTableRows=[]);let r=getApi(t[l]);a.push($.getJSON(r,{},function(e){let t=[];for(let o=0;o<e.values.length;o++){var n=Date.parse(e.values[o][2]);0==isNaN(n)&&t.push(e.values[o][2])}o[l].i4=e.values[3][8],o[l].h4=e.values[3][7],o[l].e4=e.values[3][4],o[l].last_teaching_day=t[t.length-1]}).done(()=>{count++,$(".progress-bar-label").text(`${parseInt(count/o.length*100)}%`),$(".progress-bar-label").css("width",`${parseInt(count/o.length*100)}%`),$("#percent").text(`${parseInt(count/o.length*100)}%`)}).fail(e=>{$(".popup").show(),$(".popup").append(`<h3><span style="color:red;font-size:30px;">${e.responseJSON.error.code} </span></h3>`),$(".popup").append(`<p>${e.responseJSON.error.message}</p>`),$(".popup").append(`<a href="${t[l]}" target="_blank">Check this link</a>`),$(".popup").append("<p><em><b>Hiện tại ứng dụng hoạt động không chính xác!<b/></em></p>")}))}$.when(...a,n).then(function(){if(renderTable(n,o),t.length==t.length){sortTable(2),sortTable("theTimeLeft")}})}function renderKidClass(e,t){var o=0,n=0;for(let s=e;s<t.length;s++)if("Đang Học"==t[s][3])if("LTK"==t[s][7]&&1==localStorage.getItem("classType")){n++,t[s][4]=Number(t[s][4]),hoursPaid=t[s][4];var a=t[s].i4;t[s].total_hour_learned=a;var l=Math.round(a-hoursPaid)*t[s][6];t[s].totalSalaryPerClass=l;var r=Math.round(1e3*(t[s].h4-a))/1e3;t[s].theTimeLeft=r;var i=Math.floor(1e3*(a-hoursPaid)/1e3);t[s].hoursToPay=i,o+=l,allTableRows=allTableRows.concat(t.filter(e=>allTableRows.indexOf(e)<0)),renderTableRow(t[s],s),void 0!==a&&(document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()},document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()})}else if("HVCG"==t[s][7]&&2==localStorage.getItem("classType")){n++,t[s][4]=Number(t[s][4]),hoursPaid=t[s][4];a=t[s].i4;void 0!==a&&(a=a.replace(",",".")),t[s].total_hour_learned=a;l=Math.round(a-hoursPaid)*t[s][6];t[s].totalSalaryPerClass=l;r=Math.round(1e3*(t[s].h4-a))/1e3;t[s].theTimeLeft=r;i=Math.floor(1e3*(a-hoursPaid)/1e3);t[s].hoursToPay=i,o+=l,allTableRows=allTableRows.concat(t.filter(e=>allTableRows.indexOf(e)<0)),renderTableRow(t[s],s),void 0!==a&&(document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()},document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()})}else{n++,t[s][4]=Number(t[s][4]),hoursPaid=t[s][4];a=t[s].i4;void 0!==a&&(a=a.replace(",",".")),t[s].total_hour_learned=a;l=Math.round(a-hoursPaid)*t[s][6];t[s].totalSalaryPerClass=l;r=Math.round(1e3*(t[s].h4-a))/1e3;t[s].theTimeLeft=r;i=Math.floor(1e3*(a-hoursPaid)/1e3);t[s].hoursToPay=i,o+=l,allTableRows=allTableRows.concat(t.filter(e=>allTableRows.indexOf(e)<0)),renderTableRow(t[s],s),void 0!==a&&(document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()},document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()})}var s=document.getElementById("totalSalary");isNaN(o)||window.filterOnNewTab?s.innerHTML="":(s.innerHTML="Tổng Lương : "+o,setStatusDone(n))}function renderHvcgClass(e,t){var o=0,n=0;for(let s=e;s<t.length;s++)if("Đang Học"==t[s][3]&&"HVCG"==t[s][7]){n++,t[s][4]=Number(t[s][4]),hoursPaid=t[s][4];var a=t[s].i4;t[s].total_hour_learned=a;var l=Math.round(a-hoursPaid)*t[s][6];t[s].totalSalaryPerClass=l;var r=Math.round(1e3*(t[s].h4-a))/1e3;t[s].theTimeLeft=r;var i=Math.floor(1e3*(a-hoursPaid)/1e3);t[s].hoursToPay=i,o+=l,allTableRows=allTableRows.concat(t.filter(e=>allTableRows.indexOf(e)<0)),renderTableRow(t[s],s),void 0!==a&&(document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()},document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()})}var s=document.getElementById("totalSalary");isNaN(o)||window.filterOnNewTab?s.innerHTML="":(s.innerHTML="Tổng Lương : "+o,setStatusDone(n))}function renderAllClass(e,t){var o=0,n=0;if(0==localStorage.getItem("classType")){$("#classType option[value=0]").attr("selected","selected");for(let s=e;s<t.length;s++)if("Đang Học"==t[s][3]){n++,t[s][4]=Number(t[s][4]),hoursPaid=t[s][4];var a=t[s].i4;void 0!==a&&(a=a.replace(",",".")),t[s].total_hour_learned=a;var l=Math.floor(1e3*(a-hoursPaid)/1e3),r=l*t[s][6];t[s].totalSalaryPerClass=r;var i=Math.round(1e3*(t[s].h4-a))/1e3;t[s].theTimeLeft=i,t[s].hoursToPay=l,o+=r,allTableRows=allTableRows.concat(t.filter(e=>allTableRows.indexOf(e)<0)),renderTableRow(t[s],s),void 0!==a&&(document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()},document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()})}}else if(1==localStorage.getItem("classType")){$("#classType option[value=1]").attr("selected","selected");for(let s=e;s<t.length;s++)if("Đang Học"==t[s][3]&&"LTK"==t[s][7]){n++,t[s][4]=Number(t[s][4]),hoursPaid=t[s][4];a=t[s].i4;void 0!==a&&(a=a.replace(",",".")),t[s].total_hour_learned=a;l=Math.floor(1e3*(a-hoursPaid)/1e3),r=l*t[s][6];t[s].totalSalaryPerClass=r;i=Math.round(1e3*(t[s].h4-a))/1e3;t[s].theTimeLeft=i,t[s].hoursToPay=l,o+=r,allTableRows=allTableRows.concat(t.filter(e=>allTableRows.indexOf(e)<0)),renderTableRow(t[s],s),void 0!==a&&(document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()},document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()})}}else if(2==localStorage.getItem("classType")){$("#classType option[value=2]").attr("selected","selected");for(let s=e;s<t.length;s++)if("Đang Học"==t[s][3]&&"HVCG"==t[s][7]){n++,t[s][4]=Number(t[s][4]),hoursPaid=t[s][4];a=t[s].i4;void 0!==a&&(a=a.replace(",",".")),t[s].total_hour_learned=a;l=Math.floor(1e3*(a-hoursPaid)/1e3),r=l*t[s][6];t[s].totalSalaryPerClass=r;i=Math.round(1e3*(t[s].h4-a))/1e3;t[s].theTimeLeft=i,t[s].hoursToPay=l,o+=r,allTableRows=allTableRows.concat(t.filter(e=>allTableRows.indexOf(e)<0)),renderTableRow(t[s],s),void 0!==a&&(document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()},document.getElementById("filter"+s).onclick=function(){var e=window.open(window.location.href,"_blank");e.filterOnNewTab=!0,e.filterBy=t[s],e.focus()})}}var s=document.getElementById("totalSalary");isNaN(o)||window.filterOnNewTab?s.innerHTML="":(s.innerHTML="Tổng Lương : "+o,setStatusDone(n))}function renderTable(e,t){renderAllClass(e,t)}function renderTableRow(e,t){void 0!==e.e4&&$("#table tbody").append("<tr><td>"+`<span id="filter${t}">`+e.e4+"</span></td><td>"+`<a href="${e[0]}" target="_blank">`+e[2]+"</a></td><td>"+`<a id="linkFb-${t}" href="${e[5]}" target="_blank"><?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="25" height="25" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M0 24C0 10.7452 10.7452 0 24 0C37.2548 0 48 10.7452 48 24C48 37.2548 37.2548 48 24 48C10.7452 48 0 37.2548 0 24Z" fill="#3B5998"/>\n<path d="M26.5015 38.1115V25.0542H30.1059L30.5836 20.5546H26.5015L26.5077 18.3025C26.5077 17.1289 26.6192 16.5001 28.3048 16.5001H30.5581V12H26.9532C22.6231 12 21.0991 14.1828 21.0991 17.8536V20.5551H18.4V25.0547H21.0991V38.1115H26.5015Z" fill="white"/>\n</svg></a>`+"</td><td>"+e.total_hour_learned+"</td><td>"+e.h4+`</td><td id="timeleft-${t}">`+e.theTimeLeft+"</td><td>"+e[4]+"</td><td>"+e.hoursToPay+"</td><td>"+e.last_teaching_day+"</td><td>"+e[6]+"</td><td>"+e.totalSalaryPerClass+"</td></tr>");var o=Number($(`#timeleft-${t}`).text()),n=$(`#linkFb-${t}`);o<=3&&$(`#timeleft-${t}`).css({color:"red","font-weight":"bold"}),""==n.attr("href")&&n.hide()}function sortTable(e="i4"){allTableRows.sort(function(t,o){return t=t[e],o=o[e],ascSortOrder?t<o?-1:t>o?1:0:t>o?-1:t<o?1:0}),removeTableRows(),renderTable(0,allTableRows)}function clearTimeouts(){for(var e=0;e<timeouts.length;e++)clearTimeout(timeouts[e]);timeouts=[]}function removeTableRows(){$("#table tbody").empty()}function setStatusLoading(){$("#status").html(' \n      <div class="isLoading fs-18">Đang tải dữ liệu</div>\n      <div id="loader-container">\n        <div style="margin-top: 5px;"class="loader"></div>\n        <div id="percent"></div>\n      </div>\n      ')}function setStatusDone(e){$("#status").html(`Truy vấn thành công ${e} kết quả.`),$(".progress-bar-label").hide()}function handleAuthClick(){GoogleAuth.isSignedIn.get()?GoogleAuth.signOut():GoogleAuth.signIn()}function revokeAccess(){GoogleAuth.disconnect()}function setSigninStatus(){var e=GoogleAuth.currentUser.get(),t=e.hasGrantedScopes(SCOPE);t?($("#sign-in-or-out-button").html("Sign out"),$("#revoke-access-button").css("display","inline-block"),$("#auth-status").html("Đăng nhập thành công")):($("#sign-in-or-out-button").html("Sign In/Authorize"),$("#revoke-access-button").css("display","none"),$("#auth-status").html("Xin vui lòng đăng nhập"))}function updateSigninStatus(){setSigninStatus()}var GoogleAuth,client,access_token,link_total_url_api,SCOPE="https://www.googleapis.com/auth/spreadsheets",gettedToken=[];$("#classType").on("change",function(){localStorage.setItem("classType",this.value),window.location.reload()});var timeouts=[],allTableRows=[];let count=0;var ascSortOrder=!0;$("#btn-sort-3").click(function(){ascSortOrder=!ascSortOrder,sortTable("theTimeLeft")}),$("#btn-sort-4").click(function(){ascSortOrder=!ascSortOrder,sortTable(4)}),$("#btn-sort-5").click(function(){ascSortOrder=!ascSortOrder,sortTable("hoursToPay")}),$("#btn-sort-by-student").click(function(){ascSortOrder=!ascSortOrder,sortTable(2)}),$("#btn-sort-by-mentor").click(function(){ascSortOrder=!ascSortOrder,sortTable(1)}),$("#btn-sort-last-day").click(function(){ascSortOrder=!ascSortOrder,sortTable("last_teaching_day")}),$("#btn-sort-salary").click(function(){ascSortOrder=!ascSortOrder,sortTable(6)}),$("#btn-sort-total-salary").click(function(){ascSortOrder=!ascSortOrder,sortTable("totalSalaryPerClass")});